#!/usr/bin/env node

var os = require("os"),
    rw = require("rw").dash,
    dsv = require("d3-dsv");

rw.readFile(process.argv[2] || "-", "utf8", function(error, text) {
  if (error) throw error;

  var tree = JSON.parse(text),
      nodes = [],
      id = [];

  function visit(node) {
    var name = node.name, children = node.children;
    delete node.name;
    delete node.children;
    id.push(name);
    node.id = id.join(".");
    nodes.push(node);
    if (children) children.forEach(visit);
    id.pop();
  }

  visit(tree);

  rw.writeFile("-", dsv.csvFormat(nodes) + os.EOL, "utf8", function(error) {
    if (error) throw error;
  });
});
